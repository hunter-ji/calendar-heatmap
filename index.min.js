!function(e){if("object"==typeof module&&"object"==typeof module.exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{("undefined"!=typeof globalThis?globalThis:window).CalendarHeatmap=e()}}(function(){const e=["#ebedf0","#9be9a8","#40c463","#30a14e","#216e39"],t="calendar-heatmap-style",n={view:"year",year:(new Date).getFullYear(),month:(new Date).getMonth(),weekStart:0,recentDays:7,squareSize:14,squareGap:2,colorScale:e,maxValue:null,legend:!1,tooltip:!0,locale:void 0,language:"en"},o={en:{locale:"en-US",legend:{less:"Less",more:"More"},weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],tooltip:(e,t)=>`${e} on ${t}`},"zh-cn":{locale:"zh-CN",legend:{less:"较少",more:"较多"},weekdays:["周日","周一","周二","周三","周四","周五","周六"],tooltip:(e,t)=>`${t}：${e}`},"zh-tw":{locale:"zh-TW",legend:{less:"較少",more:"較多"},weekdays:["週日","週一","週二","週三","週四","週五","週六"],tooltip:(e,t)=>`${t}：${e}`},ja:{locale:"ja-JP",legend:{less:"少ない",more:"多い"},weekdays:["日","月","火","水","木","金","土"],tooltip:(e,t)=>`${t}：${e}`},fr:{locale:"fr-FR",legend:{less:"Moins",more:"Plus"},weekdays:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],tooltip:(e,t)=>`${e} le ${t}`},de:{locale:"de-DE",legend:{less:"Weniger",more:"Mehr"},weekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],tooltip:(e,t)=>`${e} am ${t}`},ko:{locale:"ko-KR",legend:{less:"적음",more:"많음"},weekdays:["일","월","화","수","목","금","토"],tooltip:(e,t)=>`${t} ${e}`},es:{locale:"es-ES",legend:{less:"Menos",more:"Más"},weekdays:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],tooltip:(e,t)=>`${e} el ${t}`},it:{locale:"it-IT",legend:{less:"Meno",more:"Più"},weekdays:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],tooltip:(e,t)=>`${e} il ${t}`}},a={en:"en","en-us":"en","en-gb":"en",english:"en",zh:"zh-cn","zh-cn":"zh-cn","zh-hans":"zh-cn","zh-sg":"zh-cn","zh-tw":"zh-tw","zh-hant":"zh-tw","zh-hk":"zh-tw",ja:"ja","ja-jp":"ja",japanese:"ja",fr:"fr","fr-fr":"fr",french:"fr",de:"de","de-de":"de",german:"de",ko:"ko","ko-kr":"ko",korean:"ko",es:"es","es-es":"es",spanish:"es",it:"it","it-it":"it",italian:"it"};function r(){if("undefined"==typeof document)return;if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=[".ch-root { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; --ch-size: 14px; --ch-gap: 2px; }",".ch-grid { display: grid; grid-auto-flow: column; grid-auto-columns: max-content; column-gap: var(--ch-gap); }",".ch-week { display: grid; grid-template-rows: repeat(7, 1fr); row-gap: var(--ch-gap); }",`.ch-day { width: var(--ch-size); height: var(--ch-size); box-sizing: border-box; border-radius: 2px; background-color: ${e[0]}; position: relative; }`,`.ch-day[data-level="0"] { background-color: ${e[0]}; }`,".ch-tooltip { position: absolute; pointer-events: none; z-index: 9999; padding: 4px 6px; border-radius: 4px; font-size: 12px; background: rgba(17, 24, 39, 0.9); color: #fff; }",".ch-legend { display: flex; align-items: center; gap: 4px; font-size: 12px; margin-top: 8px; color: #555; }",".ch-legend .ch-swatch { display: inline-block; width: var(--ch-size); height: var(--ch-size); border-radius: 2px; }",".ch-labels { display: grid; grid-template-rows: repeat(7, var(--ch-size)); row-gap: var(--ch-gap); margin-right: 6px; font-size: 10px; color: #555; }"].join("\n"),document.head.appendChild(n)}function i(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function s(e){const t=new Map;return Array.isArray(e)?(e.forEach(e=>{if(!e)return;const n=new Date(e.date||e.day||e.dateString);if(Number.isNaN(n.getTime()))return;const o=i(n),a="number"==typeof e.value?e.value:Number(e.count);Number.isNaN(a)||t.set(o,a)}),t):t}function l(e,t){const n=new Date(e);return n.setDate(e.getDate()+t),n}function d(e,t){const n=new Date(e),o=(n.getDay()-t+7)%7;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function c(e,t){return l(d(e,t),6)}function p(t,n,o){const a=Array.isArray(o)&&o.length?o:e;if("function"==typeof o){const e=o(t,n);if("string"==typeof e)return{color:e,level:t>0?1:0};if(e&&"object"==typeof e){const n=Number(e.level),o=Number.isFinite(n)?Math.max(0,Math.min(n,a.length-1)):t>0?1:0;return{color:e.color||a[o]||a[0],level:null!=e.level?o:t>0?1:0}}}if(!t||n<=0)return{color:a[0],level:0};const r=a.length-1;if(r<=0)return{color:a[0],level:t>0?1:0};const i=Math.min(t/n,1),s=Math.max(1,Math.round(i*r));return{color:a[s],level:s}}class u{constructor(e,t=[],o={}){if("undefined"==typeof document)throw new Error("CalendarHeatmap: browser environment required.");this.container=function(e){if(!e)throw new Error("CalendarHeatmap: container is required.");if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`CalendarHeatmap: container selector "${e}" not found.`);return t}return e}(e),this.options=Object.assign({},n,o),this.data=s(t),this.tooltipDisposer=null,r(),this.render()}setOptions(e={}){this.options=Object.assign({},this.options,e),r(),this.render()}setData(e=[]){this.data=s(e),this.render()}replaceData(e=[]){this.setData(e)}render(){const{dates:t,start:n,end:r}=function(e,t){const n=t.weekStart%7;let o,a;if("year"===e){const e=Number(t.year);o=new Date(e,0,1),a=new Date(e,11,31)}else if("month"===e){const e=Number(t.year),n=Number(t.month);o=new Date(e,n,1),a=new Date(e,n+1,0)}else if("week"===e){const e=t.startDate?new Date(t.startDate):new Date;if(Number.isNaN(e.getTime()))throw new Error("CalendarHeatmap: invalid startDate for week view.");o=d(e,n),a=c(e,n)}else{if("recent"!==e)throw new Error(`CalendarHeatmap: unsupported view "${e}".`);{const e=Math.max(Number(t.recentDays)||7,1);a=new Date,a.setHours(0,0,0,0),o=l(a,1-e)}}const r=d(o,n),i=c(a,n),s=[];let p=new Date(r);for(;p<=i;)s.push(new Date(p)),p=l(p,1);return{start:o,end:a,alignedStart:r,alignedEnd:i,dates:s}}(this.options.view,this.options),s=function(e){const t=String(e||"en").toLowerCase();return o[a[t]||t]||o.en}(this.options.language||this.options.locale),u=this.options.locale||s.locale||void 0;let m;try{m=new Intl.DateTimeFormat(u,{dateStyle:"medium"})}catch(e){m=new Intl.DateTimeFormat(u,{month:"short",day:"numeric",year:"numeric"})}const f=Array.from(this.data.values()),g=null!=this.options.maxValue?this.options.maxValue:f.reduce((e,t)=>Math.max(e,t),0),y=document.createElement("div");y.className="ch-root",y.style.setProperty("--ch-size",`${this.options.squareSize}px`),y.style.setProperty("--ch-gap",`${this.options.squareGap}px`);const w=document.createElement("div");w.style.display="flex";const v=function(e,t,n){if("undefined"==typeof document)return null;const o=document.createElement("div");o.className="ch-labels";const a=Array.isArray(t.weekdays)&&7===t.weekdays.length?t.weekdays:null,r=a?null:new Intl.DateTimeFormat(n,{weekday:"short"});for(let t=0;t<7;t+=1){const n=(t+e.weekStart)%7,i=a?a[n]:r.format(new Date(2021,7,n+1)),s=document.createElement("span");s.textContent=i,o.appendChild(s)}return o}(this.options,s,u);v&&w.appendChild(v);const D=document.createElement("div");D.className="ch-grid";let b=[],k=null;const x="year"===this.options.view,S=new Date,z=this.options.weekStart%7;for(let e=0;e<t.length;e+=1){const o=t[e],a=i(o);if(x&&a>i(S))break;const s=Math.floor(e/7);k!==s&&(b.length&&(D.appendChild(h(b)),b=[]),k=s);const l=this.data.get(a)||0,{color:d,level:c}=p(l,g,this.options.colorScale),u=(o.getDay()-z+7)%7,m=document.createElement("div");m.className="ch-day",m.style.backgroundColor=d,m.dataset.level=String(c),m.dataset.value=String(l),m.dataset.date=a,m.dataset.rangeStart=i(n),m.dataset.rangeEnd=i(r),m.title="",m.style.gridRowStart=String(u+1),b.push(m)}if(b.length&&D.appendChild(h(b)),w.appendChild(D),y.appendChild(w),"year"===this.options.view&&function(e,t){if("undefined"==typeof window)return;const n=()=>{const n=e.clientWidth||e.getBoundingClientRect().width||0;if(n)for(;t.scrollWidth>n-40&&t.children.length>1;){const e=t.firstElementChild;if(!e)break;t.removeChild(e)}};"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(n):n()}(this.container,D),this.options.legend){const t=Object.assign({},o.en.legend,s.legend),n=function(t,n){if("undefined"==typeof document)return null;const o=Array.isArray(t)&&t.length?t:e,a=document.createElement("div");a.className="ch-legend";const r=document.createElement("span");r.textContent=n.less,a.appendChild(r),o.forEach(e=>{const t=document.createElement("span");t.className="ch-swatch",t.style.backgroundColor=e,a.appendChild(t)});const i=document.createElement("span");return i.textContent=n.more,a.appendChild(i),a}(this.options.colorScale,t);n&&y.appendChild(n)}if(this.container.innerHTML="",this.container.appendChild(y),this.tooltipDisposer&&(this.tooltipDisposer(),this.tooltipDisposer=null),this.options.tooltip){const e=e=>{const t=Number(e.value)||0,n=new Date(e.date),a=Number.isNaN(n.getTime())?e.date:m.format(n);return s.tooltip?s.tooltip(t,a):o.en.tooltip(t,a)};this.tooltipDisposer=function(e,t){if("undefined"==typeof document)return;let n=document.createElement("div");n.className="ch-tooltip",n.style.display="none",document.body.appendChild(n);const o=o=>{const a=o.target.closest(".ch-day");a&&e.contains(a)?(n.innerHTML=t(a.dataset),n.style.display="block",n.style.left=`${o.pageX+10}px`,n.style.top=`${o.pageY+10}px`):n.style.display="none"},a=()=>{n.style.display="none"};return e.addEventListener("mousemove",o),e.addEventListener("mouseleave",a),()=>{e.removeEventListener("mousemove",o),e.removeEventListener("mouseleave",a),n&&n.parentNode&&n.parentNode.removeChild(n),n=null}}(y,e)}}destroy(){this.tooltipDisposer&&(this.tooltipDisposer(),this.tooltipDisposer=null),this.container.innerHTML=""}}function h(e){const t=document.createElement("div");return t.className="ch-week",e.forEach(e=>{t.appendChild(e)}),t}return u.defaults=Object.assign({},n),u.languages=o,u});